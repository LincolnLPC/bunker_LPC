# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ÆKassa –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –≤ –ÆKassa

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://yookassa.ru/
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ –∏–ª–∏ –ò–ü
3. –ü—Ä–æ–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. –ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: https://yookassa.ru/my/

### 2. –°–æ–∑–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω

1. –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–ú–∞–≥–∞–∑–∏–Ω—ã"** –∏–ª–∏ **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"**
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –ó–∞–ø–∏—à–∏—Ç–µ **ID –º–∞–≥–∞–∑–∏–Ω–∞** (Shop ID) - –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 3. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á–∏

1. –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ: **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "API –∫–ª—é—á–∏"**
2. –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω—ã –∫–ª—é—á–∏
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** (Secret Key) - –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `live_...` –¥–ª—è production –∏–ª–∏ `test_...` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - **ID –º–∞–≥–∞–∑–∏–Ω–∞** (Shop ID) - —á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: 
- –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `test_`)
- –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ live –∫–ª—é—á–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `live_`)
- –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ - —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ —Å—Ä–∞–∑—É!

### 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ `.env.local` –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```env
# Payment Provider
PAYMENT_PROVIDER=yookassa

# –ÆKassa Keys
PAYMENT_SECRET_KEY=test_–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á  # –∏–ª–∏ live_... –¥–ª—è production
PAYMENT_SHOP_ID=–≤–∞—à_shop_id  # –ß–∏—Å–ª–æ–≤–æ–π ID –º–∞–≥–∞–∑–∏–Ω–∞

# Application URL
NEXT_PUBLIC_APP_URL=http://localhost:3000  # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
# NEXT_PUBLIC_APP_URL=https://your-domain.com  # –î–ª—è production
```

### 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Webhook

1. –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa –ø–µ—Ä–µ–π–¥–∏—Ç–µ: **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"**
2. –ù–∞–∂–º–∏—Ç–µ **"–ü–æ–¥–∫–ª—é—á–∏—Ç—å HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"**
3. –£–∫–∞–∂–∏—Ç–µ URL webhook:
   - **–î–ª—è production**: `https://your-domain.com/api/subscription/webhook`
   - **–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç—É–Ω–Ω–µ–ª—å
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:
   - ‚úÖ `payment.succeeded` - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
   - ‚úÖ `payment.canceled` - –æ—Ç–º–µ–Ω–∞ –æ–ø–ª–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—á–µ—Ä–µ–∑ ngrok):

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok: https://ngrok.com/download
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `pnpm dev`
3. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ ngrok:
   ```bash
   ngrok http 3000
   ```
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abc123.ngrok.io`)
5. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö webhook —É–∫–∞–∂–∏—Ç–µ: `https://abc123.ngrok.io/api/subscription/webhook`

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `pnpm dev`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–ø–∏—Å–∫–∏: `/subscription`
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –æ—Ç –ÆKassa:
   - **–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞**: `5555555555554477`
   - **–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞**: `4111111111111111`
   - –õ—é–±–∞—è –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: 12/25)
   - –õ—é–±–æ–π CVC (3 —Ü–∏—Ñ—Ä—ã)
   - –õ—é–±–æ–µ –∏–º—è –¥–µ—Ä–∂–∞—Ç–µ–ª—è –∫–∞—Ä—Ç—ã

üìã **–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç**: https://yookassa.ru/developers/payment-acceptance/testing-and-going-live/testing

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è `[Subscription Webhook] Received event: payment.succeeded`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa ‚Üí "–ü–ª–∞—Ç–µ–∂–∏" - –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ - `subscription_tier` –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å `premium`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–µ `premium_expires_at` - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

## –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã

–¢–µ–∫—É—â–∏–µ –ø–ª–∞–Ω—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `lib/payment/config.ts`:
- **–ü—Ä–µ–º–∏—É–º (–º–µ—Å—è—Ü)**: 299‚ÇΩ
- **–ü—Ä–µ–º–∏—É–º (–≥–æ–¥)**: 2,990‚ÇΩ (‚âà249‚ÇΩ/–º–µ—Å—è—Ü)

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `SUBSCRIPTION_PLANS` –≤ `lib/payment/config.ts`.

## –ü–µ—Ä–µ—Ö–æ–¥ –≤ Production

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è production**:
   - URL: `https://your-domain.com/api/subscription/webhook`
   - –°–æ–±—ã—Ç–∏—è: `payment.succeeded`, `payment.canceled`

2. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ live –∫–ª—é—á–∏**:
   - –ü–æ–ª—É—á–∏—Ç–µ live –∫–ª—é—á–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa
   - –û–±–Ω–æ–≤–∏—Ç–µ `.env.local`:
     ```env
     PAYMENT_SECRET_KEY=live_–≤–∞—à_live_–∫–ª—é—á
     PAYMENT_SHOP_ID=–≤–∞—à_shop_id
     ```

3. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `NEXT_PUBLIC_APP_URL` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ production –¥–æ–º–µ–Ω**:
   ```env
   NEXT_PUBLIC_APP_URL=https://your-domain.com
   ```

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–ª–∞—Ç–µ–∂** —Å —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ–π (–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ –≤ metadata —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
- `userId` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `planId` - ID —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
- `planInterval` - –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–¥–ø–∏—Å–∫–∏ (month/year)
- `expiresAt` - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ (ISO string)

–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ webhook –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook —á–µ—Ä–µ–∑ HMAC SHA256 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ service role client –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫ (–æ–±—Ö–æ–¥–∏—Ç RLS)
3. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ API endpoints
4. ‚úÖ Idempotency key –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π

‚ö†Ô∏è **–í–∞–∂–Ω–æ –¥–ª—è production**:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ webhook (`PAYMENT_WEBHOOK_SECRET`)
- –•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ (env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, secrets manager)
- –ù–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## Troubleshooting

### Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL webhook –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö webhook –≤—ã–±—Ä–∞–Ω–æ —Å–æ–±—ã—Ç–∏–µ `payment.succeeded`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS

### –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–µ–Ω, –Ω–æ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa ‚Üí "HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ webhook ‚Üí "–ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ `[Subscription Webhook]`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ metadata –ø–ª–∞—Ç–µ–∂–∞ –µ—Å—Ç—å `userId`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `service role client` –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `profiles`

### –û—à–∏–±–∫–∞ "–ÆKassa credentials not configured"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `PAYMENT_PROVIDER=yookassa` –≤ `.env.local`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `PAYMENT_SECRET_KEY` –∏ `PAYMENT_SHOP_ID` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env.local`

### –û—à–∏–±–∫–∞ "Failed to create payment"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `PAYMENT_SECRET_KEY` –∏ `PAYMENT_SHOP_ID`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ (test/live)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—à–∏–±–∫–∏ –æ—Ç –ÆKassa API
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (–≤ –∫–æ–ø–µ–π–∫–∞—Ö –¥–ª—è RUB)

### 401 Unauthorized –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `test_` –∏–ª–∏ `live_`)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `PAYMENT_SHOP_ID` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—á–∏—Å–ª–æ–≤–æ–π ID –º–∞–≥–∞–∑–∏–Ω–∞)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –º–∞–≥–∞–∑–∏–Ω—É

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa](https://yookassa.ru/my/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –ÆKassa](https://yookassa.ru/developers/api)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º](https://yookassa.ru/developers/using-api/webhooks)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π](https://yookassa.ru/developers/payment-acceptance/testing-and-going-live/testing)
- [–°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π](https://yookassa.ru/developers/payment-acceptance/getting-started/payment-lifecycle)

## –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è production

```env
# Production Configuration
PAYMENT_PROVIDER=yookassa
PAYMENT_SECRET_KEY=live_–úDk4MzIyOTEtOTQyMS00MmZmLThhYzMtZGVjNzcxODQwYzc4
PAYMENT_SHOP_ID=123456
NEXT_PUBLIC_APP_URL=https://bunker-online.ru
PAYMENT_WEBHOOK_SECRET=your_webhook_secret_key  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏
```
