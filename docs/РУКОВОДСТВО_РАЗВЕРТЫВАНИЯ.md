# Руководство по развертыванию «Бункер Онлайн»

Краткий чеклист для вывода приложения в production.

## 1. Переменные окружения

Настройте на платформе (Vercel, Railway и т.д.) или на сервере:

| Переменная | Описание |
|------------|----------|
| `NEXT_PUBLIC_SUPABASE_URL` | URL проекта Supabase |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Публичный anon-ключ |
| `SUPABASE_SERVICE_ROLE_KEY` | Service role ключ (только на сервере) |
| `NEXT_PUBLIC_APP_URL` | Базовый URL приложения, например `https://ваш-домен.ru` |

Для приёма платежей (Yandex Pay) дополнительно:

| Переменная | Описание |
|------------|----------|
| `PAYMENT_PROVIDER` | `yandex-pay` |
| `YANDEX_PAY_API_KEY` | Секретный API-ключ |
| `NEXT_PUBLIC_YANDEX_PAY_MERCHANT_ID` | ID магазина |
| `YANDEX_PAY_SANDBOX` | `false` для боевых платежей |

Подробнее: [ОПЛАТА_В_ПРИЛОЖЕНИИ.md](ОПЛАТА_В_ПРИЛОЖЕНИИ.md).

## 2. Supabase

- **Authentication → URL Configuration**
  - Redirect URLs: `https://ваш-домен.ru/**`, `https://ваш-домен.ru/auth/callback`
  - Site URL: `https://ваш-домен.ru`
- **Database → Replication**: включена репликация для `game_rooms`, `game_players`, `chat_messages`, `player_characteristics`, `votes`
- Все нужные миграции (таблицы, RLS, функции) выполнены в SQL Editor.

## 3. Yandex Pay (если используете подписки)

- В консоли Yandex Pay указан Callback URL: **базовый URL сайта** (например `https://ваш-домен.ru`). Webhook будет вызываться по адресу `https://ваш-домен.ru/v1/webhook`.
- Используются боевые ключи и `YANDEX_PAY_SANDBOX=false`.

## 4. Сборка и запуск

```bash
pnpm install
pnpm build
pnpm start
```

На Vercel/Railway и аналогах обычно достаточно подключить репозиторий и задать переменные окружения; сборка и старт задаются в конфигурации проекта.

## 5. Проверка после деплоя

- Открыть главную страницу и страницу входа/регистрации.
- Создать комнату и присоединиться к игре (проверка Realtime и API).
- При включённой оплате: страница `/subscription`, создание платежа и при необходимости проверка webhook в логах.

## См. также

- [README.md](../README.md) — запуск и структура проекта
- [ОПЛАТА_В_ПРИЛОЖЕНИИ.md](ОПЛАТА_В_ПРИЛОЖЕНИИ.md) — настройка оплаты
- [ИНСТРУКЦИЯ_НАСТРОЙКИ.md](../ИНСТРУКЦИЯ_НАСТРОЙКИ.md) — первичная настройка для разработки
