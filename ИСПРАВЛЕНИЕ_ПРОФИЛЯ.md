# Исправление проблемы с созданием профиля

## Проблема
При попытке зайти на страницу профиля появляется ошибка "Не удалось создать профиль".

## Решение

### Шаг 1: Выполните SQL скрипты в Supabase

Откройте Supabase SQL Editor: https://supabase.com/dashboard/project/pklwfuyxumtjbgyqlxsf/sql

Выполните в следующем порядке:

1. **`scripts/002-setup-triggers-and-storage.sql`** - создает триггер для автоматического создания профиля
2. **`scripts/005-fix-profile-policies.sql`** - исправляет RLS политики и триггер

### Шаг 2: Проверьте, что триггер работает

После выполнения скриптов, проверьте что триггер создан:

```sql
SELECT * FROM pg_trigger WHERE tgname = 'on_auth_user_created';
```

Должен вернуться хотя бы одна строка.

### Шаг 3: Проверьте RLS политики

```sql
SELECT * FROM pg_policies WHERE tablename = 'profiles';
```

Должны быть три политики:
- "Users can view all profiles" (SELECT)
- "Users can update own profile" (UPDATE)
- "Users can insert own profile" (INSERT)

### Шаг 4: Если профиль все еще не создается

1. Откройте консоль браузера (F12) и проверьте ошибки
2. Попробуйте создать профиль через API напрямую:
   - Откройте: http://localhost:3000/api/profile/create
   - Или используйте curl/Postman для POST запроса

### Альтернативное решение

Если триггер не работает, профиль будет создан автоматически при:
- Создании комнаты (POST /api/game)
- Присоединении к комнате (POST /api/game/join)
- При первом заходе на страницу профиля (через /api/profile/create)

## Что было исправлено в коде

1. ✅ Создан API endpoint `/api/profile/create` для создания профиля
2. ✅ Улучшена обработка ошибок с автоматической генерацией уникального username
3. ✅ Добавлена обработка конфликтов имени пользователя
4. ✅ Улучшены сообщения об ошибках для пользователя
