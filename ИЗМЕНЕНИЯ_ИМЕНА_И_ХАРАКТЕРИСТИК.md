# Изменения: Имена игроков и скрытие характеристик

## Выполненные изменения

### 1. Имена игроков из профиля
- ✅ Имена игроков теперь берутся из профиля пользователя (`display_name` или `username`)
- ✅ При присоединении к комнате используется имя из профиля, а не случайное русское имя
- ✅ Если профиля нет, создается автоматически

### 2. Все характеристики скрыты изначально
- ✅ Пол (gender), Возраст (age) и Профессия (profession) теперь являются характеристиками
- ✅ Все характеристики создаются с `is_revealed: false` - полностью скрыты изначально
- ✅ Характеристики отображаются только если они раскрыты, или если это текущий игрок, или если это хост

### 3. Обновленные компоненты UI
- ✅ `PlayerCard` - показывает пол/возраст/профессию только если раскрыты
- ✅ `PlayerDetailModal` - показывает все характеристики по правилам раскрытия
- ✅ `WaitingRoom` - показывает профессию только если раскрыта
- ✅ `VotingPanel` - показывает профессию только если раскрыта
- ✅ `VoteResults` - показывает профессию только если раскрыта
- ✅ `MysteryJournal` - показывает пол/возраст/профессию только если раскрыты
- ✅ `GameResults` - показывает пол/возраст/профессию только если раскрыты
- ✅ `SacrificialAltar` - использует характеристики для исключенных игроков
- ✅ `CharacteristicsManager` - показывает профессию из характеристик

## SQL скрипты для выполнения

### Обязательно выполните:

1. **`scripts/001-create-tables.sql`** (если еще не выполняли)
   - Создает базовую структуру таблиц

2. **`scripts/008-add-gender-age-profession-as-characteristics.sql`**
   - Обновляет constraint для категорий, добавляя `gender`, `age`, `profession`
   - Это необходимо для работы новых характеристик

3. **`scripts/005-fix-profile-policies.sql`** (если еще не выполняли)
   - Исправляет RLS политики для профилей

4. **`scripts/006-fix-profile-creation-service-role.sql`** (если еще не выполняли)
   - Создает функцию для создания профилей

5. **`scripts/003-add-media-settings.sql`** (если еще не выполняли)
   - Добавляет колонку `media_settings` в профили

6. **`scripts/004-add-ready-status.sql`** (если еще не выполняли)
   - Добавляет статус готовности игроков

7. **`scripts/007-setup-storage-bucket.sql`** (если планируете загружать аватары)
   - Настраивает Storage для аватаров

## Важные замечания

### Для существующих игроков:
- Если у вас уже есть игроки в базе данных с характеристиками, их пол/возраст/профессия останутся в полях `game_players`
- Новые игроки будут иметь пол/возраст/профессию как характеристики
- Для существующих игроков можно запустить SQL из комментария в `scripts/008-add-gender-age-profession-as-characteristics.sql`

### При исключении игрока:
- Все характеристики (включая пол, возраст, профессию) автоматически раскрываются
- Это происходит в API endpoint `/api/game/eliminate`

### Имена пользователей:
- Используется `display_name` из профиля, если указан
- Если нет, используется `username`
- Если нет и username, используется часть email до @
- Если нет email, используется `User_${userId.slice(0, 8)}`

## Порядок выполнения SQL скриптов

1. `scripts/001-create-tables.sql`
2. `scripts/005-fix-profile-policies.sql`
3. `scripts/008-add-gender-age-profession-as-characteristics.sql` (новый!)
4. `scripts/003-add-media-settings.sql`
5. `scripts/004-add-ready-status.sql`
6. `scripts/006-fix-profile-creation-service-role.sql` (опционально)
7. `scripts/007-setup-storage-bucket.sql` (опционально)

## Проверка

После выполнения всех скриптов:
1. Создайте новую комнату и присоединитесь к ней
2. Проверьте, что имя берется из профиля
3. Проверьте, что пол, возраст и профессия скрыты в UI
4. Раскройте характеристику - она должна появиться в UI
5. Исключите игрока - все характеристики должны раскрыться
